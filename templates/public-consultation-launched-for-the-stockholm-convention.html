<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!--<meta name=description content="This site was generated with Anima. www.animaapp.com"/>-->
    <!-- <link rel="shortcut icon" type=image/png href="https://animaproject.s3.amazonaws.com/home/favicon.png" /> -->
    <meta name="viewport" content="width=1440, maximum-scale=1.0" />
    <link rel="shortcut icon" type="image/png" href="https://animaproject.s3.amazonaws.com/home/favicon.png" />
    <meta name="og:type" content="website" />
    <meta name="twitter:card" content="photo" />
    <link rel="stylesheet" type="text/css" href="css/desktop-3.css" />
    <link rel="stylesheet" type="text/css" href="css/styleguide.css" />
    <link rel="stylesheet" type="text/css" href="css/globals.css" />

    <style>
      #chatHistory {
          height: 400px;
          overflow-y: auto;
          border: 1px solid #ccc;
          padding: 28px;
          margin-bottom: 0px;
          width: 1096px;
          background-color: white;
          margin-top:4px;
          border-radius: 8px;
          display: none;
          margin-bottom: -12px;
          resize: both;
      }
      #chatHistory .message {
        color: var(--gray700);
        font-family: var(--font-family-inter);
        font-size: var(--font-size-m);
        font-style: normal;
        font-weight: 400;
        line-height: 168%;
        margin-bottom: 16px;
      }
      .messagebox {
        position: relative;
      }
      .message strong {
        font-weight: bold;
      }
      #chatHistory .message:nth-child(2n) {
          /* Your styles here */
          margin-bottom: 40px; /* Example: setting a different background color */
      }
      #chat-assisstant {
        /* margin-top: 16px; */
        margin-bottom: 16px;
      }
      #userInput {
        height: 48px;
        width: 800px;
        padding: 20px;
        font-size: 18px;
        margin-top: 0px;
        border: 1px solid rgba(0,0,0,0.2);
        border-radius: 40px;
      }
      #userInput:focus {
        outline: none;
      }
      button {
        padding: 5px 10px;
        position: absolute;
        right: 6px;
        top: 6px;
        background-color: var(--blue-2);
        border: none;
        border-radius: 70px;
        height: 36px;
        width: 36px;
        cursor: pointer;
      }
      button:hover {
        background-color: #dbe5fc;
      }
      .typing::after {
          content: '▋';
          animation: blink 1s step-start infinite;
      }
      .arrow-narrow-right {
        color: blue;
        position: absolute;
        top: 6px;
        right: 6px;
      }
      @keyframes blink {
          50% { opacity: 0; }
      }
      .frame-39641 {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .frame-39896-1,
      .frame-39896-2 {
        width: 100%;
      }

      .qp-question {
        display: block;
        /* padding: 10px; */

        border-radius: 5px;
        text-decoration: none;
        color: #333;
        transition: background-color 0.3s;
      }

      .qp-question .text-2 {
        font-size: 16px;
        line-height: 1.4;
        word-wrap: break-word;
      }

      .message p {
            margin-bottom: 12px;
        }

        .message ul, .message ol {
            margin-left: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
            list-style-type: disc;
        }

        .message li {
            margin-bottom: 8px;
        }

        .message strong {
            font-weight: bold;
        }

        .message em {
            font-style: italic;
        }
  </style>
  </head>
  <body style="margin: 0">
    <input type="hidden" id="anPageName" name="page" value="desktop-3" />
    <div class="container-center-horizontal">
      <div class="desktop-3 screen">
        <div class="overlap-group1">
          <div class="main">
            <div class="flex-row-1">
              <div class="frame-container">
                <div class="frame-39906">
                  <a href="alerts.html"
                    ><div class="text-6 valign-text-middle inter-normal-mirage-16px">My Alerts</div>
                  </a>
                  <p class="text-7 valign-text-middle">
                    <span
                      ><span class="span0">/</span><span class="inter-bold-mirage-16px">&nbsp;</span
                      ><span class="span2 text-mdsemibold">&nbsp;</span
                      ><span class="span3 text-mdmedium">Public Consultation Launched for the Stockholm Convention</span>
                    </span>
                  </p>
                </div>
                <div class="frame-39824">
                  <article class="badge"><div class="text text-smmedium">BPR</div></article>
                  
                </div>
              </div>
              <div class="frame-39828">
                <div class="actions">
                  <div class="button">
                    <img class="bell-plus" src="img/bell-plus.svg" alt="bell-plus" />
                    <div class="text-1 text-smsemibold">Set reminder</div>
                  </div>
                </div>
                <div class="actions-1 actions-3">
                  <div class="button-1">
                    <img class="share-07" src="img/share-07.svg" alt="share-07" />
                    <div class="text-1 text-smsemibold">Share</div>
                  </div>
                </div>
                <div class="actions-1 actions-3">
                  <div class="button-1">
                    <img class="share-07" src="img/invite.svg" alt="share-07" />
                    <div class="text-1 text-smsemibold">Invite</div>
                  </div>
                </div>
                <!-- <div class="button-2">
                  <img class="check" src="img/check-1.svg" alt="check" />
                  <div class="text-8 text-smsemibold">Accept</div>
                </div> -->
              </div>
            </div>
            <div class="frame-39873">
              <div class="frame-39896">
                <div class="frame-39893">
                  <div class="frame-39893-1">
                    <div class="frame-39902">
                      <div class="frame-39852">
                        <div class="rectangle-18"></div>
                        <p class="text-9">
                          <span class="inter-semi-bold-mirage-20px">Summary: </span
                          ><span class="span1"
                            >The Stockholm Convention is updating its guidelines on managing persistent organic pollutants (POPs) and is seeking public comments on draft documents by 16 September 2024. Key areas under review include specific chemicals like UV-328, SCCPs, and PBDEs. Feedback will help finalize guidelines to protect health and the environment.</span
                          >
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


              <div id="chatHistory"></div>

              <div class="messagebox">
                <input type="text" id="userInput" placeholder="Ask a question...">
                <button onclick="sendMessage()"><img class="arrow-narrow-right" src="img/arrow-narrow-right-blue.svg" alt="arrow-narrow-left" />
                </button>
              </div>


              <div id="chat-assisstant">
                <div class="frame-39626" id="quickPromptsContainer">
                  <div class="frame-39597">
                    <div class="frame-39674">
                      <img class="star-06" src="img/star-06-2.svg" alt="star-06" />
                      <div class="heading inter-semi-bold-mirage-18px" style="font-size: 16px;">Quick insights</div>
                    </div>
                    <div class="frame-39641">
                      <div class="frame-39896-1 frame-39896-5">
                        <a href="#" class="qp-question group-39601">
                          <div class="component-1">
                            <p class="text-2 text-mdmedium">How can I submit feedback on the Stockholm Convention’s draft guidelines for managing persistent organic pollutants?</p>
                          </div>
                        </a>
                      </div>
                      <div class="frame-39896-1 frame-39896-5">
                        <a href="#" class="qp-question group-39597">
                          <div class="component-1">
                            <div class="text-2 text-mdmedium">What are the key chemicals under review in the latest Stockholm Convention guidelines?</div>
                          </div>
                        </a>
                      </div>
                      <div class="frame-39896-2 frame-39896-5">
                        <a href="#" class="qp-question group-39599">
                          <div class="component-1">
                            <p class="text-2 text-mdmedium">When is the deadline for submitting comments on the Stockholm Convention’s draft guidelines?</p>
                          </div>
                        </a>
                      </div>
                      <div class="frame-39896-2 frame-39896-5">
                        <a href="#" class="qp-question group-39600">
                          <div class="component-1">
                            <p class="text-2 text-mdmedium">What are the main updates in the Stockholm Convention’s draft guidelines for POPs management?</p>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="loadingPrompts" style="display: none;">
                  <p>Generating new prompts...</p>
                </div>

                <script>
                  function showChatHistory() {
                      const chatHistory = document.getElementById('chatHistory');
                      chatHistory.style.display = 'block';
                  }
                  
                  function addMessage(sender, message) {
                      showChatHistory();
                      const chatHistory = document.getElementById('chatHistory');
                      const messageElement = document.createElement('div');
                      messageElement.className = 'message';
                      
                      if (sender === 'Question') {
                          messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
                      } else {
                          // For answers, apply the formatting
                          const formattedMessage = formatResponse(message);
                          messageElement.innerHTML = `<strong>${sender}:</strong> ${formattedMessage}`;
                      }
                      
                      chatHistory.appendChild(messageElement);
                      chatHistory.scrollTop = chatHistory.scrollHeight;
                      return messageElement;
                  }
                  
                  function formatResponse(text) {
                      // Convert Markdown-style formatting to HTML
                      text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Bold
                      text = text.replace(/\*(.*?)\*/g, '<em>$1</em>'); // Italic
                      
                      // Handle numbered lists
                      text = text.replace(/^\d+\.\s+/gm, '<li>');
                      text = text.replace(/(<li>.*?\n)(?!<li>)/g, '$1</li>');
                      text = text.replace(/(<li>.*?\n)+/g, '<ol>$&</ol>');
                      
                      // Handle bullet points
                      text = text.replace(/^\-\s+/gm, '<li>');
                      text = text.replace(/(<li>.*?\n)(?!<li>)/g, '$1</li>');
                      text = text.replace(/(<li>.*?\n)+/g, '<ul>$&</ul>');
                      
                      // Split into paragraphs
                      const paragraphs = text.split('\n\n');
                      return paragraphs.map(p => `<p>${p}</p>`).join('');
                  }
                  
                  function hideQuickPrompts() {
                      document.getElementById('chat-assisstant').style.display = 'none';
                      document.getElementById('loadingPrompts').style.display = 'block';
                  }
                  
                  function showQuickPrompts() {
                      document.getElementById('chat-assisstant').style.display = 'block';
                      document.getElementById('loadingPrompts').style.display = 'none';
                  }
                  
                  async function generateNewPrompts(question, answer) {
                      try {
                          const response = await fetch('/generate_prompts', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json',
                              },
                              body: JSON.stringify({ question: question, answer: answer }),
                          });
                          
                          if (!response.ok) {
                              throw new Error('Failed to generate new prompts');
                          }
                          
                          const newPrompts = await response.json();
                          updatePromptQuestions(newPrompts);
                      } catch (error) {
                          console.error('Error generating new prompts:', error);
                          showQuickPrompts(); // Show prompts even if there's an error
                      }
                  }
                  
                  function updatePromptQuestions(newPrompts) {
                      const promptElements = document.querySelectorAll('.qp-question .text-2');
                      newPrompts.forEach((prompt, index) => {
                          if (index < promptElements.length) {
                              promptElements[index].textContent = prompt;
                          }
                      });
                      showQuickPrompts();
                  }
                  
                  async function sendMessage(message = null, retries = 3, delay = 1000) {
                      const userInput = document.getElementById('userInput');
                      if (!message) {
                          message = userInput.value.trim();
                      }
                      if (message) {
                          addMessage('Question', message);
                          userInput.value = '';
                          hideQuickPrompts();

                          const responseElement = addMessage('Answer', '<span class="typing"></span>');

                          for (let attempt = 0; attempt < retries; attempt++) {
                              try {
                                  const response = await fetch('/chat', {
                                      method: 'POST',
                                      headers: {
                                          'Content-Type': 'application/json',
                                      },
                                      body: JSON.stringify({
                                          message: message,
                                          page_name: 'tris4nonylphenyl-phosphite-identified-as-potential-endocrine-disruptor'  // Pass the page name here
                                      }),
                                  });

                                  if (response.status === 429) {
                                      throw new Error('Rate limit exceeded');
                                  }

                                  const reader = response.body.getReader();
                                  const decoder = new TextDecoder();
                                  let responseText = '';

                                  while (true) {
                                      const { done, value } = await reader.read();
                                      if (done) break;

                                      const chunk = decoder.decode(value);
                                      responseText += chunk;
                                      const formattedResponse = formatResponse(responseText);
                                      responseElement.innerHTML = `<strong>Answer:</strong> ${formattedResponse}<span class="typing"></span>`;
                                      chatHistory.scrollTop = chatHistory.scrollHeight;
                                  }

                                  const finalFormattedResponse = formatResponse(responseText);
                                  responseElement.innerHTML = `<strong>Answer:</strong> ${finalFormattedResponse}`;

                                  await generateNewPrompts(message, responseText);
                                  return;
                              } catch (error) {
                                  console.error('Error:', error);
                                  if (attempt === retries - 1) {
                                      responseElement.innerHTML = `<strong>Answer:</strong> An error occurred while fetching the response. Please try again later.`;
                                      showQuickPrompts();
                                  } else {
                                      responseElement.innerHTML = `<strong>Answer:</strong> Rate limit exceeded. Retrying in ${delay / 1000} seconds...`;
                                      await new Promise(resolve => setTimeout(resolve, delay));
                                      delay *= 2;
                                  }
                              }
                          }
                      }
                  }
                  
                  document.getElementById('userInput').addEventListener('keypress', function (e) {
                      if (e.key === 'Enter') {
                          sendMessage();
                      }
                  });
                  
                  document.querySelectorAll('.qp-question').forEach(element => {
                      element.addEventListener('click', function(e) {
                          e.preventDefault();
                          const question = this.querySelector('.text-2').textContent;
                          sendMessage(question);
                      });
                  });
                  
                  // Initialize quick prompts
                  showQuickPrompts();
                  </script>
                
              </div>




              <div class="group-39837">
                <div class="frame-39858">
                  <div class="table">
                    <div class="label-and-text">
                      <div class="label text-smmedium">Date</div>
                      <div class="text-and-icon">
                        <div class="text-3 inter-normal-oxford-blue-16px">23 August 2024</div>
                      </div>
                    </div>
                    <div class="label-and-text-1 label-and-text-6">
                      <div class="label text-smmedium">Geography</div>
                      <div class="text-and-icon">
                        <article class="badge-1">
                          <div class="text-4 inter-normal-oxford-blue-14px">European Economic Area</div>
                        </article>
                        <article class="badge-1">
                          <div class="text-4 inter-normal-oxford-blue-14px">Northern Ireland</div>
                        </article>
                      </div>
                    </div>
                    <!-- <div class="label-and-text-2 label-and-text-6">
                      <div class="label text-smmedium">Initiative</div>
                      <div class="text-and-icon">
                        <article class="badge-1">
                          <div class="text-4 inter-normal-oxford-blue-14px">European Green Deal</div>
                        </article>
                        <article class="badge-1">
                          <div class="text-4 inter-normal-oxford-blue-14px">Chemicals Strategy for Sustainability</div>
                        </article>
                      </div>
                    </div> -->
                    <!-- <div class="frame-39896-3 frame-39896-5">
                      <div class="label-and-text-3 label-and-text-6">
                        <div class="label text-smmedium">Product types affected</div>
                        <div class="text-and-icon">
                          <p class="text-3 inter-normal-oxford-blue-16px">
                            Childcare articles, industrial chemicals, consumer products, professional use chemicals,
                            articles containing hazardous substances
                          </p>
                        </div>
                      </div>
                      <div class="alert">
                        <img class="alert-triangle" src="img/alert-triangle.svg" alt="alert-triangle" />
                        <div class="content-1 content-3">
                          <div class="text-and-supporting-text">
                            <p class="text-10 text-smsemibold">This alert affects 5 of your products</p>
                          </div>
                          <div class="actions-2 actions-3">
                            <div class="button-3"><div class="text-11 text-smsemibold">Learn more</div></div>
                          </div>
                        </div>
                        <div class="close-x">
                          <div class="button-close-x">
                            <img class="x-close" src="img/x-close-1.svg" alt="x-close" />
                          </div>
                        </div>
                      </div>
                    </div> -->
                    <!-- <div class="label-and-text-4 label-and-text-6">
                      <div class="label text-smmedium">Uses affected</div>
                      <div class="text-and-icon">
                        <p class="text-3 inter-normal-oxford-blue-16px">
                          Industrial, professional, consumer, and article applications involving hazardous substances
                        </p>
                      </div>
                    </div> -->
                    <!-- <div class="group-39855">
                      <div class="label-1 label-3 text-smmedium">Next steps</div>
                      <p class="stakeholders-should">
                        Stakeholders should review the detailed substance restrictions in the roadmap, assess their
                        current use of these substances, and prepare for compliance with the upcoming regulations.
                        Specific attention should be paid to the timelines and requirements for submitting relevant
                        information to ECHA.
                      </p>
                    </div> -->
                    <div class="label-and-text-5 label-and-text-6">
                      <div class="label-2 label-3 text-smmedium">Source</div>
                      <div class="frame-39857">
                        <img class="favicon-2" src="img/stockholm.png" alt="favicon 2" />
                        <a
                          href="https://echa.europa.eu/information-on-chemicals/evaluation/community-rolling-action-plan/corap-table/-/dislist/details/0b0236e1807e7192"
                          target="_blank"
                          ><div class="text-12 text-mdmedium">Stockholm Convention: Joint Toolkit and expert roster</div> </a
                        >
                        <!-- <img class="icon" src="img/icon.svg" alt="Icon" /> -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          
          <div class="sidebar-navigation">
            <div class="content-2 content-3">
              <div class="nav">
                <div class="navigation">
                  <div class="dropdown">
                    <div class="button-4">
                      <div class="group-39831">
                        <div class="image-65"><img src="img/rina.png" width="20"></div>
                        <div class="text-4 inter-semi-bold-oxford-blue-15px">Avery Dennison</div>
                      </div>
                      <img class="chevron-down" src="img/chevron-down.svg" alt="chevron-down" />
                    </div>
                  </div>
                  <div class="group-39832">
                    <div class="flex-col flex">
                      <div class="frame-39896-4 frame-39896-5">
                        <a href="logged-in.html">
                          <div class="nav-item-base">
                            <div class="content">
                              <img
                                class="bar-chart-square-02"
                                src="img/bar-chart-square-02.svg"
                                alt="bar-chart-square-02"
                              />
                              <div class="text-5 text-mdsemibold">Home</div>
                            </div>
                          </div>
                        </a>

                        <a href="alerts.html">
                          <div class="nav-item-base-3 nav-item-base-4">
                            <div class="content">
                              <img class="bell-02" src="img/bell-02.svg" alt="bell-02" />
                              <div class="text-5 text-mdsemibold">My Alerts</div>
                            </div>
                          </div></a
                        >

                        <a href="assistant.html">
                          <div class="nav-item-base-2 nav-item-base-5">
                            <div class="content">
                              <img class="bookmark-check" src="img/message-dots-circle.svg" alt="bookmark-check" />
                              <div class="text text-mdsemibold">Assistant</div>
                            </div>
                          </div>
                          </a>

                          <div class="nav-item-base">
                            <div class="content">
                              <img class="bookmark-check" src="img/bookmark-check.svg" alt="bookmark-check" />
                              <div class="text-5 text-mdsemibold">Subscriptions</div>
                            </div>
                          </div>

                        <a href="calendar.html">
                          <div class="nav-item-base-4 nav-item-base-5">
                            <div class="content">
                              <img class="bookmark-check" src="img/calendar.svg" alt="bookmark-check" />
                              <div class="text text-mdsemibold">Calendar</div>
                            </div>
                          </div>
                        </a>

                      </div>
                      <div class="nav-item-base-1 nav-item-base-4">
                        <div class="text-14 inter-normal-mirage-14px">MONITORING</div>
                      </div>
                      <div class="nav-item-base-2 nav-item-base-4">
                        <div class="content">
                          <img class="scales-02" src="img/scales-02.svg" alt="scales-02" />
                          <div class="text-5 text-mdsemibold">Legislation</div>
                        </div>
                      </div>
                      <div class="nav-item-base-2 nav-item-base-4">
                        <div class="content">
                          <img class="cube-01" src="img/cube-01.svg" alt="cube-01" />
                          <div class="text-5 text-mdsemibold">Products</div>
                        </div>
                      </div>
                      <div class="nav-item-base-2 nav-item-base-4">
                        <div class="content">
                          <img class="beaker-01" src="img/beaker-01.svg" alt="beaker-01" />
                          <div class="text-5 text-mdsemibold">Substances</div>
                        </div>
                      </div>
                      <div class="group-39833">
                        <div class="nav-item-base-1 nav-item-base-4">
                          <div class="text-15 inter-normal-mirage-14px">MANAGE</div>
                        </div>
                        <div class="nav-item-base-2 nav-item-base-4">
                          <div class="content">
                            <img class="folder" src="img/folder.svg" alt="folder" />
                            <div class="text-5 text-mdsemibold">Documents</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <footer class="footer">
                <div class="account">
                  <div class="avatar-label-group">
                    <div class="group-39807">
                      <div class="overlap-group"><div class="text-16 valign-text-middle text-smmedium">AL</div></div>
                    </div>
                    <div class="text-and-supporting-text-1">
                      <div class="text-17 text-smsemibold">Lauren Kobetitsch</div>
                    </div>
                  </div>
                  <div class="button-5"><img class="log-out-01" src="img/log-out-01.svg" alt="log-out-01" /></div>
                </div>
              </footer>
            </div>
          </div>
          <div class="group-39826">
            <div class="group-39805">
              <div class="group-21">
                <div class="flex-col-2 flex-col-3">
                  <div class="rectangle-1 rectangle-3"></div>
                  <div class="flex-row flex">
                    <div class="rectangle-2 rectangle-3"></div>
                    <div class="rectangle-6 rectangle-3"></div>
                  </div>
                </div>
                <div class="flex-row flex">
                  <div class="rectangle"></div>
                  <div class="rectangle"></div>
                  <div class="rectangle"></div>
                </div>
              </div>
              <img class="foresight" src="img/foresight-3.svg" alt="foresight">
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
